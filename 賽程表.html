<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°å¤¥ä¼´ç«¶è³½åœ–è¡¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&family=Noto+Sans+TC:wght@400;700&family=Handlee&display=swap" rel="stylesheet">
    <style>
        /* åŸºç¤å®šç¾© */
        :root {
            --cute-pink: #ff9fb2;
            --cute-blue: #a0e7ff;
            --cute-green: #b2f2bb;
            --cute-yellow: #fff382;
            --bg-soft: #fff9fb;
        }

        body {
            transition: background 0.3s ease;
            font-family: 'Noto Sans TC', sans-serif;
            min-height: screen;
        }

        .cute-font {
            font-family: 'ZCOOL KuaiLe', 'Noto Sans TC', cursive;
        }

        /* --- ä¸»é¡Œ 1: å¤¢å¹»ç”œé» (Cute) --- */
        body.theme-cute {
            background-color: var(--bg-soft);
            background-image: radial-gradient(#ffd1dc 1px, transparent 0);
            background-size: 30px 30px;
            color: #5d5d5d;
        }

        .theme-cute .bubble-card {
            background: white;
            border: 3px solid #ffe4e9;
            border-radius: 25px;
            box-shadow: 0 8px 0px #ffe4e9;
        }

        .theme-cute .winner-active {
            background: linear-gradient(135deg, #fff382 0%, #ffc107 100%);
            border-color: #ff9800 !important;
            color: #855d00 !important;
            box-shadow: 0 8px 0px #e68a00 !important;
        }

        /* --- ä¸»é¡Œ 2: æ ¡åœ’å¡—é´‰ (School) --- */
        body.theme-school {
            background-color: #f0f4f8;
            background-image: 
                linear-gradient(#e1e8f0 1px, transparent 1px),
                linear-gradient(90deg, #e1e8f0 1px, transparent 1px);
            background-size: 20px 20px;
            color: #2d3748;
        }

        .theme-school .bubble-card {
            background: #fff;
            border: 2px solid #4a5568;
            border-radius: 4px;
            transform: rotate(-1deg);
            box-shadow: 5px 5px 0px #4a5568;
            position: relative;
        }

        .theme-school .bubble-card::before {
            content: '';
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 15px;
            background: rgba(255, 255, 0, 0.4); /* è† å¸¶æ•ˆæœ */
            z-index: 10;
        }

        .theme-school .winner-active {
            background: #4299e1 !important;
            color: white !important;
            border-color: #2b6cb0 !important;
            box-shadow: 5px 5px 0px #2b6cb0 !important;
            transform: rotate(1deg) scale(1.05);
        }

        /* å…±é€šå‹•ç•«èˆ‡é€£ç·š */
        .connector-dot {
            width: 10px;
            height: 10px;
            background-color: currentColor;
            opacity: 0.3;
            border-radius: 50%;
            margin: 15px auto;
            position: relative;
        }

        .connector-line-v {
            width: 2px;
            height: 40px;
            background: currentColor;
            opacity: 0.2;
            margin: 0 auto;
        }

        /* è‡ªå®šç¾©æŒ‰éˆ• */
        .btn-style {
            transition: all 0.2s;
            border-bottom-width: 4px;
        }
        .btn-style:active {
            transform: translateY(2px);
            border-bottom-width: 0;
        }

        /* éš±è—æ²è»¸ */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.1); border-radius: 10px; }
    </style>
</head>
<body class="theme-cute min-h-screen pb-20">
    <div class="max-w-4xl mx-auto p-6">
        <header class="mb-10 text-center pt-10">
            <div class="inline-block relative">
                <span id="header-icon-left" class="absolute -top-6 -left-8 text-4xl">âœ¨</span>
                <h1 id="main-title" class="text-4xl md:text-5xl font-black cute-font text-pink-400 mb-2 tracking-wider transition-colors">
                    å°å¯æ„›å°é™£åœ–
                </h1>
                <span id="header-icon-right" class="absolute -bottom-4 -right-8 text-4xl">ğŸ€</span>
            </div>
            <p id="sub-title" class="mt-4 text-pink-300 font-bold tracking-widest text-sm transition-colors uppercase">è®“ä½ çš„ç«¶è³½å……æ»¿é©šå–œå§ï¼</p>
        </header>

        <!-- è¨­å®šå€åŸŸ -->
        <div id="setup-section" class="bg-white/90 backdrop-blur-sm rounded-[40px] p-8 border-4 border-pink-100 shadow-xl transition-all">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="md:col-span-2">
                    <!-- é¢¨æ ¼åˆ‡æ›å€ -->
                    <div class="mb-8">
                        <label class="block text-gray-400 font-bold mb-3 text-sm flex items-center gap-2">
                            <span>ğŸ¨</span> é¸æ“‡ç•«é¢¨
                        </label>
                        <div class="flex gap-4">
                            <button onclick="changeTheme('cute')" id="btn-theme-cute" class="flex-1 py-3 rounded-2xl border-2 border-pink-200 bg-pink-50 text-pink-500 font-bold transition-all hover:scale-105 ring-4 ring-pink-100">
                                ğŸ­ å¤¢å¹»ç”œé»
                            </button>
                            <button onclick="changeTheme('school')" id="btn-theme-school" class="flex-1 py-3 rounded-2xl border-2 border-slate-200 bg-slate-50 text-slate-500 font-bold transition-all hover:scale-105">
                                ğŸ’ æ ¡åœ’å¡—é´‰
                            </button>
                        </div>
                    </div>

                    <label class="block text-pink-400 font-bold mb-3 text-lg flex items-center gap-2" id="label-names">
                        <span>ğŸ“</span> å¡«å¯«åƒè³½å¤¥ä¼´åå–®
                    </label>
                    <textarea id="player-input" rows="6" class="w-full bg-pink-50/30 border-2 border-pink-100 rounded-[25px] p-5 text-gray-600 focus:ring-4 focus:ring-pink-200 outline-none transition placeholder-pink-200 text-lg" placeholder="æ¯è¡Œè¼¸å…¥ä¸€å€‹åå­—..."></textarea>
                    
                    <div class="mt-8 flex flex-wrap gap-4">
                        <button onclick="generateBracket()" id="btn-generate" class="bg-pink-400 hover:bg-pink-500 text-white font-bold py-4 px-10 rounded-full text-lg shadow-lg active:scale-95 transition border-b-4 border-pink-600">
                            ğŸ’– ç”Ÿæˆåœ–è¡¨
                        </button>
                        <button onclick="addDemoPlayers()" class="bg-blue-50 text-blue-400 border-b-4 border-blue-100 font-bold py-4 px-8 rounded-full hover:bg-blue-100 transition">
                            ğŸ¬ è¼‰å…¥ç¯„ä¾‹
                        </button>
                    </div>
                </div>
                
                <div class="space-y-4">
                    <div id="tip-box" class="bg-yellow-50 rounded-[30px] p-6 border-2 border-yellow-100">
                        <h3 class="text-yellow-600 font-bold mb-2 flex items-center gap-2">
                            <span>ğŸ’¡</span> å°æ’‡æ­¥
                        </h3>
                        <ul class="text-sm text-yellow-700/80 space-y-3 leading-relaxed">
                            <li>ğŸ­ é»æ“Šåå­—å°±èƒ½æ™‰ç´šå–”ï¼</li>
                            <li>ğŸŒˆ ç³»çµ±æœƒè‡ªå‹•è™•ç†è¼ªç©ºã€‚</li>
                            <li>â­ æœ€å¾Œç•™ä¸‹çš„å°±æ˜¯å† è»ï¼</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- åœ–è¡¨å€åŸŸ -->
        <div id="bracket-area" class="hidden space-y-12">
            <div class="flex justify-between items-center bg-white/60 p-4 rounded-full px-8 shadow-sm">
                <h2 id="bracket-title" class="text-xl font-bold cute-font text-pink-400 flex items-center gap-2">
                    <span class="animate-bounce">ğŸ†</span> ç²¾å½©å°æˆ°
                </h2>
                <button onclick="showResetModal()" class="text-sm font-bold text-gray-400 hover:text-pink-400 transition flex items-center gap-1">
                    <span>âŒ</span> å…¨éƒ¨é‡ä¾†
                </button>
            </div>

            <div id="rounds-container" class="flex flex-col items-center">
                <!-- ç”± JavaScript ç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <!-- è‡ªå®šç¾©é‡ç½®å½ˆçª— -->
    <div id="reset-modal" class="fixed inset-0 z-[100] hidden flex items-center justify-center p-4 bg-white/80 backdrop-blur-sm">
        <div class="bg-white border-4 border-pink-100 rounded-[40px] p-8 max-w-sm w-full shadow-2xl text-center">
            <div class="text-6 font-bold mb-4">(â€¢ã……â€¢)</div>
            <h3 class="text-2xl font-black cute-font text-pink-400 mb-2">ç¢ºå®šè¦é‡ä¾†å—ï¼Ÿ</h3>
            <p class="text-gray-400 mb-8 font-bold">ç´€éŒ„éƒ½æœƒä¸è¦‹å–”ï¼</p>
            <div class="flex gap-4 justify-center">
                <button onclick="closeResetModal()" class="px-6 py-3 bg-gray-100 text-gray-500 font-bold rounded-full hover:bg-gray-200 transition">
                    å…ˆä¸è¦
                </button>
                <button onclick="resetAll()" id="btn-confirm-reset" class="px-8 py-3 bg-pink-400 text-white font-bold rounded-full border-b-4 border-pink-600 transition">
                    å—¯ï¼é‡ä¾†
                </button>
            </div>
        </div>
    </div>

    <!-- è¨Šæ¯æç¤º -->
    <div id="message-box" class="fixed bottom-10 left-1/2 transform -translate-x-1/2 translate-y-20 opacity-0 transition-all duration-500 z-50">
        <div id="msg-container" class="bg-white border-4 border-pink-200 text-pink-400 font-black px-10 py-4 rounded-full shadow-2xl cute-font text-xl">
            <span id="message-text"></span>
        </div>
    </div>

    <script>
        let participants = [];
        let bracketData = [];
        let currentTheme = 'cute';

        function changeTheme(theme) {
            currentTheme = theme;
            document.body.className = `theme-${theme}`;
            
            // æ›´æ–° UI é¡è‰²
            const title = document.getElementById('main-title');
            const sub = document.getElementById('sub-title');
            const btnGen = document.getElementById('btn-generate');
            const btnResetConfirm = document.getElementById('btn-confirm-reset');
            const setupBox = document.getElementById('setup-section');
            const labelNames = document.getElementById('label-names');
            const headerLeft = document.getElementById('header-icon-left');
            const headerRight = document.getElementById('header-icon-right');

            if (theme === 'school') {
                title.className = "text-4xl md:text-5xl font-black cute-font text-blue-500 mb-2 tracking-wider transition-colors";
                title.textContent = "æ ¡åœ’ç«¶è³½å°é™£åœ–";
                sub.className = "mt-4 text-blue-400 font-bold tracking-widest text-sm transition-colors uppercase";
                sub.textContent = "èªçœŸæ¯”è³½ï¼Œé–‹å¿ƒå­¸ç¿’ï¼";
                btnGen.className = "bg-blue-400 hover:bg-blue-500 text-white font-bold py-4 px-10 rounded-full text-lg shadow-lg active:scale-95 transition border-b-4 border-blue-600";
                btnGen.innerHTML = "ğŸ’ é–‹å§‹æ¯”è³½å•¦ï¼";
                btnResetConfirm.className = "px-8 py-3 bg-blue-400 text-white font-bold rounded-full border-b-4 border-blue-600 transition";
                setupBox.className = "bg-white/90 backdrop-blur-sm rounded-xl p-8 border-4 border-slate-300 shadow-xl transition-all";
                labelNames.className = "block text-blue-500 font-bold mb-3 text-lg flex items-center gap-2";
                headerLeft.textContent = "ğŸ’";
                headerRight.textContent = "âœï¸";
                
                document.getElementById('btn-theme-cute').className = "flex-1 py-3 rounded-2xl border-2 border-slate-200 bg-slate-50 text-slate-500 font-bold transition-all hover:scale-105";
                document.getElementById('btn-theme-school').className = "flex-1 py-3 rounded-2xl border-2 border-blue-200 bg-blue-50 text-blue-500 font-bold transition-all hover:scale-105 ring-4 ring-blue-100";
            } else {
                title.className = "text-4xl md:text-5xl font-black cute-font text-pink-400 mb-2 tracking-wider transition-colors";
                title.textContent = "å°å¯æ„›å°é™£åœ–";
                sub.className = "mt-4 text-pink-300 font-bold tracking-widest text-sm transition-colors uppercase";
                sub.textContent = "è®“ä½ çš„ç«¶è³½å……æ»¿é©šå–œå§ï¼";
                btnGen.className = "bg-pink-400 hover:bg-pink-500 text-white font-bold py-4 px-10 rounded-full text-lg shadow-lg active:scale-95 transition border-b-4 border-pink-600";
                btnGen.innerHTML = "ğŸ’– ç”Ÿæˆåœ–è¡¨";
                btnResetConfirm.className = "px-8 py-3 bg-pink-400 text-white font-bold rounded-full border-b-4 border-pink-600 transition";
                setupBox.className = "bg-white/80 backdrop-blur-sm rounded-[40px] p-8 border-4 border-pink-100 shadow-xl transition-all";
                labelNames.className = "block text-pink-400 font-bold mb-3 text-lg flex items-center gap-2";
                headerLeft.textContent = "âœ¨";
                headerRight.textContent = "ğŸ€";

                document.getElementById('btn-theme-cute').className = "flex-1 py-3 rounded-2xl border-2 border-pink-200 bg-pink-50 text-pink-500 font-bold transition-all hover:scale-105 ring-4 ring-pink-100";
                document.getElementById('btn-theme-school').className = "flex-1 py-3 rounded-2xl border-2 border-slate-200 bg-slate-50 text-slate-500 font-bold transition-all hover:scale-105";
            }
        }

        function showMessage(msg) {
            const box = document.getElementById('message-box');
            const text = document.getElementById('message-text');
            const container = document.getElementById('msg-container');
            text.textContent = msg;
            
            if(currentTheme === 'school') {
                container.className = "bg-white border-4 border-blue-200 text-blue-500 font-black px-10 py-4 rounded-xl shadow-2xl cute-font text-xl";
            } else {
                container.className = "bg-white border-4 border-pink-200 text-pink-400 font-black px-10 py-4 rounded-full shadow-2xl cute-font text-xl";
            }

            box.classList.remove('translate-y-20', 'opacity-0');
            setTimeout(() => {
                box.classList.add('translate-y-20', 'opacity-0');
            }, 3000);
        }

        function addDemoPlayers() {
            const demo = currentTheme === 'school' 
                ? "ä¸€å¹´ä¸€ç­\nä¸€å¹´äºŒç­\näºŒå¹´ä¸€ç­\näºŒå¹´äºŒç­\nä¸‰å¹´ä¸€ç­\nä¸‰å¹´äºŒç­\nå››å¹´ä¸€ç­\nå››å¹´äºŒç­"
                : "è‰è“å¤§ç¦\nç„¦ç³–å¸ƒä¸\né¦™è‰æ³¡èŠ™\næŠ¹èŒ¶æ‹¿éµ\nè—è“èµ·å¸\næª¸æª¬å¡”\nå·§å…‹åŠ›å·\nç´…è±†é¤…";
            document.getElementById('player-input').value = demo;
        }

        function generateBracket() {
            const input = document.getElementById('player-input').value.trim();
            if (!input) {
                showMessage(currentTheme === 'school' ? "è€å¸«èªªè¦å…ˆå¯«åå­—å–”ï¼ğŸ’" : "å“å‘€ï¼å¿˜è¨˜è¼¸å…¥åå­—äº† ğŸ€");
                return;
            }

            participants = input.split('\n').map(p => p.trim()).filter(p => p !== "");
            if (participants.length < 2) {
                showMessage(currentTheme === 'school' ? "è‡³å°‘è¦å…©å€‹ç­ç´šæ‰èƒ½æ¯”è³½ï¼ğŸ«" : "è‡³å°‘è¦å…©å€‹äººæ‰èƒ½æ¯”è³½å–” ğŸ­");
                return;
            }

            let nextPowerOfTwo = 1;
            while (nextPowerOfTwo < participants.length) nextPowerOfTwo *= 2;

            const round1 = [];
            const byeText = currentTheme === 'school' ? "ğŸ« è¼ªç©ºä¼‘æ¯" : "ğŸŒ¸ ç¨®å­è¼ªç©º";
            for (let i = 0; i < nextPowerOfTwo; i += 2) {
                round1.push({
                    p1: participants[i] || byeText,
                    p2: participants[i + 1] || byeText,
                    winner: null
                });
            }

            bracketData = [round1];
            let currentRoundSize = round1.length / 2;
            while (currentRoundSize >= 0.5) {
                const nextRound = [];
                for (let i = 0; i < currentRoundSize; i++) {
                    nextRound.push({ p1: null, p2: null, winner: null });
                }
                bracketData.push(nextRound);
                if (currentRoundSize === 0.5) break;
                currentRoundSize /= 2;
            }

            autoAdvanceByes();
            render();
            
            document.getElementById('bracket-area').classList.remove('hidden');
            document.getElementById('setup-section').classList.add('hidden');
            window.scrollTo({ top: document.getElementById('bracket-area').offsetTop - 20, behavior: 'smooth' });
        }

        function autoAdvanceByes() {
            const byeText = currentTheme === 'school' ? "ğŸ« è¼ªç©ºä¼‘æ¯" : "ğŸŒ¸ ç¨®å­è¼ªç©º";
            bracketData[0].forEach((match, idx) => {
                if (match.p2 === byeText) advance(0, idx, match.p1);
                else if (match.p1 === byeText) advance(0, idx, match.p2);
            });
        }

        function advance(roundIdx, matchIdx, player) {
            const byeText = currentTheme === 'school' ? "ğŸ« è¼ªç©ºä¼‘æ¯" : "ğŸŒ¸ ç¨®å­è¼ªç©º";
            const waitText = currentTheme === 'school' ? "æº–å‚™ä¸­..." : "ç­‰å¾…ä¸­...";
            if (!player || player === byeText || player === waitText) return;

            bracketData[roundIdx][matchIdx].winner = player;
            const nextRoundIdx = roundIdx + 1;
            if (nextRoundIdx < bracketData.length) {
                const nextMatchIdx = Math.floor(matchIdx / 2);
                if (matchIdx % 2 === 0) bracketData[nextRoundIdx][nextMatchIdx].p1 = player;
                else bracketData[nextRoundIdx][nextMatchIdx].p2 = player;
                clearPath(nextRoundIdx, nextMatchIdx);
            }

            render();
            if (roundIdx === bracketData.length - 2) {
                const winMsg = currentTheme === 'school' ? "ğŸ† æ­å–œå¤§å† è»ï¼š " : "ğŸ‰ è¶…ç´šå† è»èª•ç”Ÿï¼š ";
                showMessage(winMsg + player + " âœ¨");
            }
        }

        function clearPath(roundIdx, matchIdx) {
            if (roundIdx >= bracketData.length) return;
            const match = bracketData[roundIdx][matchIdx];
            match.winner = null;
            const nextRoundIdx = roundIdx + 1;
            if (nextRoundIdx < bracketData.length) {
                const nextMatchIdx = Math.floor(matchIdx / 2);
                if (matchIdx % 2 === 0) bracketData[nextRoundIdx][nextMatchIdx].p1 = null;
                else bracketData[nextRoundIdx][nextMatchIdx].p2 = null;
                clearPath(nextRoundIdx, nextMatchIdx);
            }
        }

        function render() {
            const container = document.getElementById('rounds-container');
            container.innerHTML = '';

            bracketData.forEach((round, rIdx) => {
                const roundWrapper = document.createElement('div');
                roundWrapper.className = "w-full flex flex-col items-center mb-10";

                const title = document.createElement('div');
                title.className = "cute-font font-bold mb-6 text-xl flex items-center gap-3 " + (currentTheme === 'school' ? 'text-blue-500' : 'text-pink-300');
                
                let titleText = `ç¬¬ ${rIdx + 1} è¼ª`;
                let icon = currentTheme === 'school' ? "âœï¸" : "ğŸˆ";
                if (rIdx === bracketData.length - 1) { 
                    titleText = currentTheme === 'school' ? "ğŸ… å…¨æ ¡ç¸½å† è»" : "ğŸ‘‘ å¤¢å¹»å¤§å† è»"; 
                    icon = "ğŸ†"; 
                }
                else if (rIdx === bracketData.length - 2) { 
                    titleText = currentTheme === 'school' ? "æ±ºè³½æ“‚å°" : "æœ€å¾Œå¤§å°æ±º"; 
                    icon = "ğŸ”¥"; 
                }
                
                title.innerHTML = `<span>${icon}</span> ${titleText} <span>${icon}</span>`;
                roundWrapper.appendChild(title);

                const matchesGrid = document.createElement('div');
                matchesGrid.className = "flex flex-wrap justify-center gap-6 w-full";

                round.forEach((match, mIdx) => {
                    const matchCard = document.createElement('div');
                    matchCard.className = "bubble-card min-w-[200px] overflow-hidden";

                    [match.p1, match.p2].forEach((p, pIdx) => {
                        if (rIdx === bracketData.length - 1 && pIdx === 1) return;
                        const waitText = currentTheme === 'school' ? "æº–å‚™ä¸­..." : "ç­‰å¾…ä¸­...";
                        const byeText = currentTheme === 'school' ? "ğŸ« è¼ªç©ºä¼‘æ¯" : "ğŸŒ¸ ç¨®å­è¼ªç©º";
                        const playerName = p || (rIdx === 0 ? "---" : waitText);
                        const isWinner = match.winner === playerName && playerName !== waitText && playerName !== byeText;
                        
                        const pEl = document.createElement('div');
                        const borderClass = currentTheme === 'school' ? 'border-b-2 border-slate-100' : 'border-b-2 border-pink-50';
                        pEl.className = `px-6 py-4 cursor-pointer transition-all flex justify-between items-center
                            ${pIdx === 0 && rIdx !== bracketData.length - 1 ? borderClass : ''}
                            ${isWinner ? 'winner-active' : 'opacity-80 hover:bg-slate-50'}`;
                        
                        pEl.innerHTML = `
                            <span class="font-bold truncate max-w-[140px]">${playerName}</span>
                            ${isWinner ? '<span>â­</span>' : ''}
                        `;
                        pEl.onclick = () => advance(rIdx, mIdx, playerName);
                        matchCard.appendChild(pEl);
                    });
                    matchesGrid.appendChild(matchCard);
                });

                roundWrapper.appendChild(matchesGrid);
                container.appendChild(roundWrapper);
                if (rIdx < bracketData.length - 1) {
                    const line = document.createElement('div');
                    line.className = "connector-line-v";
                    container.appendChild(line);
                }
            });
        }

        function showResetModal() { document.getElementById('reset-modal').classList.remove('hidden'); }
        function closeResetModal() { document.getElementById('reset-modal').classList.add('hidden'); }
        function resetAll() {
            document.getElementById('bracket-area').classList.add('hidden');
            document.getElementById('setup-section').classList.remove('hidden');
            participants = [];
            bracketData = [];
            document.getElementById('rounds-container').innerHTML = '';
            closeResetModal();
            showMessage(currentTheme === 'school' ? "é‡æ–°ä¸‹èª²å†é–‹å§‹ï¼(à¹‘Â¯âˆ€Â¯à¹‘)" : "å·²ç¶“æ¸…ç©ºå›‰ï¼(à¹‘Â´ã…‚`à¹‘)");
        }
    </script>
</body>
</html>